# HTTP

HTTP--Hyper Text Transfer Protocol，超文本传输协议，是一种建立在TCP上的无状态连接，整个基本的工作流程是客户端发送一个HTTP请求，说明客户端想要访问的资源和请求的动作，服务端收到请求之后，服务端开始处理请求，并根据请求做出相应的动作访问服务器资源，最后通过发送HTTP响应把结果返回给客户端。其中一个请求的开始到一个响应的结束称为事务.

## HTTP请求

HTTP请求由三部分组成:__状态行__、__请求头__、__请求正文__.

- 状态行：请求方式Method、资源路径URL、协议版本Version
- 请求头：访问的域名、用户代理、Cookie
- 请求正文：HTTP请求的数据

备注：请求方式Method一般有GET、POST、PUT、DELETE. 大多数协议版本为http/1.1.

## HTTP响应

HTTP响应由三部分组成：__状态行__、__响应头__、__响应正文__.

- 状态行：协议版本Version、状态码Status Code、回应短语；
- 响应头：搭建服务器的软件，发送响应的时间，数据的格式等信息；
- 响应正文：响应的具体数据

| 状态码 |           含义                  |
| ----- | :----------------------------:  |
|  1xx  | 表示HTTP请求已经接受，继续处理请求   |
|  2xx  | 表示HTTP请求已经处理完成           |
|  3xx  | 表示把请求访问的URL重定向到其他目录  |
|  4xx  | 表示客户端出现错误                 |
|  5xx  | 表示服务端出现错误                 |

### HTTP响应模型

- 单进程I/O模型: 服务端开启一个进程，一个进程仅能处理一个请求，并且对请求顺序处理
- 多进程I/O模型: 服务端并行开启多个进程，同样的一个进程只能处理一个请求，服务端可以同时处理多个请求
- 复用I/O模型:  服务端开启一个进程，同时开启多个线程，一个线程响应一个请求，同时处理多个请求，线程间并发执行
- 复用多线程I/O模型: 服务端并行开启多个进程，同时每个进程开启多个线程，这样服务端可以同时处理进程数M*每个进程的线程数N个请求

## 一次完整的HTTP请求

1. __建立TCP连接__:在HTTP工作开始之前，Web浏览器首先要通过网络与Web服务器建立连接，该连接是通过TCP来完成的，该协议与IP协议共同构建 Internet，即著名的TCP/IP协议族，因此Internet又被称作是TCP/IP网络。HTTP是比TCP更高层次的应用层协议，根据规则， 只有低层协议建立之后才能，才能进行更层协议的连接，因此，首先要建立TCP连接，一般TCP连接的端口号是80。

2. __Web浏览器向Web服务器发送请求命令__: 一旦建立了TCP连接，Web浏览器就会向Web服务器发送请求命令。例如：GET/sample/test.jsp HTTP/1.1。

3. __Web浏览器发送请求头信息__: 浏览器发送其请求命令之后，还要以头信息的形式向Web服务器发送一些别的信息，之后浏览器发送了一空白行来通知服务器，它已经结束了该头信息的发送。

4. __Web服务器应答__: 客户机向服务器发出请求后，服务器会客户机回送应答， HTTP/1.1 200 OK ，应答的第一部分是协议的版本号和应答状态码。

5. __Web服务器发送应答头信息__: 正如客户端会随同请求发送关于自身的信息一样，服务器也会随同应答向用户发送关于它自己的数据及被请求的文档。

6. __Web服务器向浏览器发送数据__: Web服务器向浏览器发送头信息后，它会发送一个空白行来表示头信息的发送到此为结束，接着，它就以Content-Type应答头信息所描述的格式发送用户所请求的实际数据。

7. __Web服务器关闭TCP连接__

### HTTP请求报文

![HTTP请求报文](../images/http-1.png)

- ＜request-line＞请求行：请求方法字段、URL字段和HTTP协议版本字段3个字段组成，它们用空格分隔。例如，GET /index.html HTTP/1.1。HTTP协议的请求方法有GET、POST、HEAD、PUT、DELETE、OPTIONS、TRACE、CONNECT。
- ＜headers＞请求头: 请求头部由关键字/值对组成，每行一对，关键字和值用英文冒号“:”分隔。请求头部通知服务器有关于客户端请求的信息
- ＜blank line＞空格: 最后一个请求头之后是一个空行，发送回车符和换行符，通知服务器以下不再有请求头。
- ＜request-body＞请求数据: 请求数据不在GET方法中使用，而是在POST方法中使用。POST方法适用于需要客户填写表单的场合。

### HTTP响应报文

- ＜status-line＞状态行
- ＜headers＞消息报头
- ＜blank line＞
- ＜response-body＞响应正文

参考： [HTTP响应头和请求头信息对照表](http://tools.jb51.net/table/http_header)
